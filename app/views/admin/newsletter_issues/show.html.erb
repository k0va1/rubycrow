<div class="mb-2">
  <%= link_to "← Newsletter Issues", admin_newsletter_issues_path, class: "text-sm admin-link-back" %>
</div>

<div class="mb-6 flex items-center justify-between">
  <h1 class="admin-heading text-2xl font-semibold">Issue #<%= @newsletter_issue.issue_number %></h1>

  <div class="flex items-center gap-2">
    <% if @newsletter_issue.sent_at.present? %>
      <%= lui.badge(status: :success) { "Published" } %>
    <% else %>
      <%= lui.button(url: publish_admin_newsletter_issue_path(@newsletter_issue), data: { turbo_method: :post, turbo_confirm: "This will send the newsletter to all active subscribers. Are you sure?" }) { "Publish" } %>
    <% end %>
    <%= lui.button(url: edit_admin_newsletter_issue_path(@newsletter_issue), style: :outline) { "Edit" } %>
    <%= link_to "Delete", admin_newsletter_issue_path(@newsletter_issue), data: { turbo_method: :delete, turbo_confirm: "Delete this issue?" }, class: "inline-flex items-center rounded-lg px-3 py-2 text-sm font-medium admin-delete-btn" %>
  </div>
</div>

<%= lui.description_list do |list| %>
  <% list.with_item(label: "Issue Number", value: @newsletter_issue.issue_number) %>
  <% list.with_item(label: "Subject", value: @newsletter_issue.subject) %>
  <% list.with_item(label: "Sent At", value: @newsletter_issue.sent_at&.strftime("%b %d, %Y %H:%M") || "—") %>
  <% list.with_item(label: "Subscriber Count", value: @newsletter_issue.subscriber_count) %>
  <% list.with_item(label: "Total Clicks", value: @newsletter_issue.total_clicks) %>
  <% list.with_item(label: "Total Unique Clicks", value: @newsletter_issue.total_unique_clicks) %>
  <% list.with_item(label: "Click Through Rate", value: "#{@newsletter_issue.click_through_rate}%") %>

  <% list.with_item(label: "Tracked Links") do %>
    <%= link_to "View tracked links", admin_tracked_links_path(newsletter_issue_id: @newsletter_issue.id) %>
  <% end %>
<% end %>

<% if @newsletter_issue.newsletter_sections.any? %>
  <h2 class="admin-heading mt-8 mb-4 text-xl font-semibold">Sections</h2>

  <div class="space-y-4">
    <% @newsletter_issue.newsletter_sections.each do |section| %>
      <div class="rounded-lg border p-4" style="border-color: var(--lui-theme-border); background: var(--lui-theme-surface-secondary);">
        <h3 class="font-semibold admin-heading mb-2"><%= section.title %></h3>

        <% if section.newsletter_items.any? %>
          <ul class="space-y-2">
            <% section.newsletter_items.each do |item| %>
              <li class="rounded border p-3" style="border-color: var(--lui-theme-border);">
                <div class="font-medium admin-heading"><%= link_to item.title, item.url, target: "_blank", class: "admin-link-secondary" %></div>
                <% if item.description.present? %>
                  <p class="text-sm admin-subtext mt-1"><%= item.description %></p>
                <% end %>
                <p class="text-xs admin-faint mt-1"><%= item.url %></p>
              </li>
            <% end %>
          </ul>
        <% else %>
          <p class="text-sm admin-faint">No items in this section.</p>
        <% end %>
      </div>
    <% end %>
  </div>
<% end %>

<h2 class="admin-heading mt-8 mb-4 text-xl font-semibold">Email Preview</h2>
<div class="rounded-lg border overflow-hidden" style="border-color: var(--lui-theme-border);">
  <iframe src="<%= preview_admin_newsletter_issue_path(@newsletter_issue) %>" class="w-full" style="height: 800px; border: none; background: #0a0a0a;"></iframe>
</div>
