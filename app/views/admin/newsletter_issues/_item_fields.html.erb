<%# locals: (item_form:) -%>
<div
  data-nested-form-wrapper
  class="space-y-2 rounded-lg border p-3"
  style="border-color: var(--lui-theme-border); background: var(--lui-theme-surface-secondary);"
>
  <div data-controller="linkable-selector" class="flex items-end gap-2">
    <span data-sortable-handle class="admin-faint mb-2 cursor-grab text-lg">&#9776;</span>

    <div class="grid flex-1 grid-cols-2 gap-2">
      <div>
        <%= lui.select(
          name: :linkable_type,
          form: item_form,
          label: "Source",
          options_for_select: options_for_select(
            [["None", ""], ["Article", "Article"], ["Gem", "RubyGem"], ["GitHub Repo", "GithubRepo"], ["Reddit Post", "RedditPost"]],
            item_form.object.linkable_type
          ),
          select_data: {
            linkable_selector_target: "typeSelect",
            action: "change->linkable-selector#typeChanged"
          }
        ) %>
      </div>

      <div data-linkable-selector-target="panel" data-linkable-type="Article"
           data-controller="linkable-autofill" data-linkable-autofill-url-value="<%= admin_article_searches_path %>"
           class="<%= "hidden" unless item_form.object.linkable_type == "Article" %>">
        <%= lui.combobox(
          name: :linkable_id,
          form: item_form,
          label: "Article",
          placeholder: "Search articles…",
          url: admin_article_searches_path,
          min_chars: 2,
          debounce: 250
        ) %>
      </div>

      <div data-linkable-selector-target="panel" data-linkable-type="RubyGem"
           data-controller="linkable-autofill" data-linkable-autofill-url-value="<%= admin_gem_searches_path %>"
           class="<%= "hidden" unless item_form.object.linkable_type == "RubyGem" %>">
        <%= lui.combobox(
          name: :linkable_id,
          form: item_form,
          label: "Gem",
          placeholder: "Search gems…",
          url: admin_gem_searches_path,
          min_chars: 2,
          debounce: 250
        ) %>
      </div>

      <div data-linkable-selector-target="panel" data-linkable-type="GithubRepo"
           data-controller="linkable-autofill" data-linkable-autofill-url-value="<%= admin_github_repo_searches_path %>"
           class="<%= "hidden" unless item_form.object.linkable_type == "GithubRepo" %>">
        <%= lui.combobox(
          name: :linkable_id,
          form: item_form,
          label: "GitHub Repo",
          placeholder: "Search repos…",
          url: admin_github_repo_searches_path,
          min_chars: 2,
          debounce: 250
        ) %>
      </div>

      <div data-linkable-selector-target="panel" data-linkable-type="RedditPost"
           data-controller="linkable-autofill" data-linkable-autofill-url-value="<%= admin_reddit_post_searches_path %>"
           class="<%= "hidden" unless item_form.object.linkable_type == "RedditPost" %>">
        <%= lui.combobox(
          name: :linkable_id,
          form: item_form,
          label: "Reddit Post",
          placeholder: "Search posts…",
          url: admin_reddit_post_searches_path,
          min_chars: 2,
          debounce: 250
        ) %>
      </div>
    </div>

    <div class="mb-0.5">
      <%= lui.button(type: :button, style: :outline, icon: "trash", data: { action: "nested-form#remove" }) %>
    </div>
  </div>

  <%= lui.input(name: :title, form: item_form, label: "Title") %>
  <%= lui.input(name: :url, form: item_form, type: :url, label: "URL") %>
  <%= lui.textarea(name: :description, form: item_form, label: "Description", rows: 2) %>

  <%= item_form.hidden_field :id %>
  <%= item_form.hidden_field :position %>
  <%= item_form.hidden_field :_destroy, value: "0" %>
</div>
