<%# locals: (newsletter_issue:) -%>
<% if newsletter_issue.errors.any? %>
  <div class="mb-4">
    <%= lui.alert(type: :error) do %>
      <%= pluralize(newsletter_issue.errors.count, "error") %>
      prevented this issue from being saved:
      <ul class="mt-2 list-inside list-disc text-sm">
        <% newsletter_issue.errors.full_messages.each do |message| %>
          <li><%= message %></li>
        <% end %>
      </ul>
    <% end %>
  </div>
<% end %>

<%= form_with model: [:admin, newsletter_issue], class: "space-y-6" do |form| %>
  <div class="max-w-2xl space-y-4">
    <%= lui.input(name: :issue_number, form: form, type: :number, label: "Issue Number") %>
    <%= lui.textarea(name: :subject, form: form, label: "Subject") %>
  </div>

  <div data-controller="nested-form">
    <div class="mb-4 flex items-center justify-between">
      <h3 class="admin-heading text-lg font-semibold">Sections</h3>
      <%= lui.button(type: :button, style: :outline, icon: "plus", data: { action: "nested-form#add" }) %>
    </div>

    <div data-nested-form-target="container" data-controller="sortable" class="space-y-4">
      <%= form.fields_for :newsletter_sections do |section_form| %>
        <%= render "section_fields", section_form: section_form %>
      <% end %>
    </div>

    <template data-nested-form-target="template">
      <%= form.fields_for :newsletter_sections, NewsletterSection.new, child_index: "NEW_RECORD" do |section_form| %>
        <%= render "section_fields", section_form: section_form %>
      <% end %>
    </template>
  </div>

  <div><%= lui.button(type: :submit) { newsletter_issue.persisted? ? "Update Issue" : "Create Issue" } %></div>
<% end %>
